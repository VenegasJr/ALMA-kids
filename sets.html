<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sets y Tarifas Variables - ALMA Kids</title>
    <meta name="description" content="Configura y ajusta los precios de tus sets y packs. Precios variables con IVA incluido, guardados en tu navegador.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="layout-fixes.css">
    <link rel="stylesheet" href="visual-fixes.css">
    <style>
        .sets-container { max-width: 1100px; margin: 40px auto; padding: 0 16px; }
        .sets-title { font-size: 1.9rem; margin-bottom: 6px; }
        .sets-sub { color:#6c7a89; margin-bottom: 18px; }
        .sets-actions { display:flex; gap:10px; margin: 12px 0 18px; }
        .sets-actions .btn { padding:8px 12px; border-radius:8px; border:1px solid rgba(0,0,0,.08); background:#fff; cursor:pointer; }
        .sets-table { width:100%; border-collapse: collapse; background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:12px; overflow:hidden; }
        .sets-table th, .sets-table td { padding:12px; border-bottom:1px solid rgba(0,0,0,.06); text-align:left; }
        .sets-table th { background:#f8fafc; font-weight:700; }
        .sets-table tr:last-child td { border-bottom:none; }
        .price-input { width: 120px; padding:6px 8px; border:1px solid rgba(0,0,0,.15); border-radius:8px; text-align:right; }
        .badge { font-size:.85rem; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#3b82f6; display:inline-block; }
        .note { color:#7f8c8d; font-size:.92rem; }
        .right { text-align:right; }
        .danger { color:#e53935; }
        @media (max-width: 720px){ .price-input{ width:100px } .sets-table th:nth-child(3){display:none} .sets-table td:nth-child(3){display:none} }
    </style>
</head>
<body>
    <!-- Header est치ndar -->
    <header class="header">
        <div class="container">
        <div class="header-content">
            <a class='logo' href='index.html'>
                <img src="logo-header.png?v=20250115-4" alt="ALMA Kids - Entretenciones Infantiles" class="logo-image">
            </a>
            <nav class="nav">
                <a class='nav-link' href='index.html#inicio'>Inicio</a>
                <a class='nav-link' href='eventos.html'>Eventos</a>
                <a class='nav-link' href='castillos-inflables.html'>Castillos Inflables</a>
                <a class='nav-link' href='servicios-adicionales.html'>Servicios Adicionales</a>
                <a class='nav-link' href='faq.html'>FAQ</a>
                <a class='nav-link' href='index.html#contacto'>Contacto</a>
            </nav>
            <div class="header-buttons">
                <button class="btn btn-search" onclick="toggleSearch()"><i class="fas fa-search"></i></button>
            </div>
        </div>
        </div>
    </header>

    <main class="sets-container">
        <h1 class="sets-title">游닍 Sets y Tarifas Variables</h1>
        <p class="sets-sub">Ajusta los precios finales (IVA incluido). Los cambios quedan guardados en tu navegador.</p>

        <div class="sets-actions">
            <button class="btn" id="addRowBtn"><i class="fas fa-plus"></i> Agregar Set</button>
            <button class="btn" id="resetBtn"><i class="fas fa-undo"></i> Restablecer valores</button>
        </div>

        <div style="overflow:auto">
        <table class="sets-table" id="setsTable">
            <thead>
                <tr>
                    <th>Categor칤a</th>
                    <th>Nombre</th>
                    <th>C칩digo</th>
                    <th class="right">Base (sin IVA)</th>
                    <th class="right">IVA 19%</th>
                    <th class="right">Total (con IVA)</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="setsBody"></tbody>
        </table>
        </div>
        <p class="note">Los valores se guardan en <strong>localStorage</strong> para que puedas iterar f치cilmente. Luego podemos exportarlos a CSV.</p>
    </main>

    <script>
        const IVA = 0.19;
        const DEFAULT_ROWS = [
            { category:'Castillos Inflables', name:'Castillo Rosas', code:'CI-ROS-001', total:75000 },
            { category:'Castillos Inflables', name:'Castillo Inflable', code:'CI-RED-001', total:75001 },
            { category:'Servicios Adicionales', name:'Carpa Tipi', code:'CT-001', total:15000 },
            { category:'Servicios Adicionales', name:'Inflable Carestino', code:'IS-001', total:15000 },
            { category:'Servicios Adicionales', name:'M치quina de Burbujas', code:'MB-001', total:15000 },
            { category:'Piscina de Pelotas', name:'Piscina Celeste', code:'PP-CEL-001', total:55001 },
            { category:'Piscina de Pelotas', name:'Piscina Rosada', code:'PP-ROS-001', total:55001 },
            { category:'Set de Motricidad', name:'Set Motricidad', code:'SM-001', total:45001 }
        ];

        const KEY = 'alma-sets-v1';
        function loadRows(){
            try { return JSON.parse(localStorage.getItem(KEY)) || DEFAULT_ROWS; } catch(e){ return DEFAULT_ROWS; }
        }
        function saveRows(rows){ localStorage.setItem(KEY, JSON.stringify(rows)); }
        function clp(n){ try{return n.toLocaleString('es-CL',{style:'currency',currency:'CLP'});}catch(e){return `$${Math.round(n).toLocaleString('es-CL')}`;} }
        function render(){
            const body = document.getElementById('setsBody');
            const rows = loadRows();
            body.innerHTML = '';
            rows.forEach((r, idx)=>{
                const base = Math.round(r.total / (1+IVA));
                const iva = r.total - base;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><input class="price-input" style="width:170px" value="${r.category}"></td>
                    <td><input class="price-input" style="width:220px" value="${r.name}"></td>
                    <td><input class="price-input" style="width:120px" value="${r.code}"></td>
                    <td class="right">${clp(base)}</td>
                    <td class="right">${clp(iva)}</td>
                    <td class="right"><input class="price-input" data-total idx="${idx}" value="${r.total}"></td>
                    <td class="right"><button class="btn" data-del idx="${idx}"><i class='fas fa-trash danger'></i></button></td>
                `;
                body.appendChild(tr);
            });
        }
        function hook(){
            const table = document.getElementById('setsTable');
            table.addEventListener('input', (e)=>{
                const rows = loadRows();
                const t = e.target;
                const tr = t.closest('tr');
                const idx = Number(t.getAttribute('idx'));
                const inputs = tr.querySelectorAll('input');
                // update text inputs (category/name/code)
                const allInputs = table.querySelectorAll('tbody tr');
                const newRows = Array.from(allInputs).map((row,i)=>{
                    const cells = row.querySelectorAll('input');
                    const totalInput = row.querySelector('[input][data-total]') || row.querySelector('[data-total]');
                    return {
                        category: cells[0].value,
                        name: cells[1].value,
                        code: cells[2].value,
                        total: Number((row.querySelector('[data-total]')||{}).value || rows[i]?.total || 0)
                    };
                });
                saveRows(newRows);
                render();
            });
            table.addEventListener('click',(e)=>{
                const del = e.target.closest('[data-del]');
                if(del){
                    const idx = Number(del.getAttribute('idx'));
                    const rows = loadRows();
                    rows.splice(idx,1); saveRows(rows); render();
                }
            });
            document.getElementById('addRowBtn').addEventListener('click',()=>{
                const rows = loadRows();
                rows.push({ category:'Nueva Categor칤a', name:'Nuevo Set', code:'NEW-001', total:10000 });
                saveRows(rows); render();
            });
            document.getElementById('resetBtn').addEventListener('click',()=>{ saveRows(DEFAULT_ROWS); render(); });
        }
        document.addEventListener('DOMContentLoaded', ()=>{ render(); hook(); });
    </script>
</body>
</html>

